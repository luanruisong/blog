<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.79.0" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Golang Reflect &middot; anwu&#39;s blog</title>
  <meta name="description" content="Golang Reflect 包对于未知参数的处理" />

  
  <link type="text/css" rel="stylesheet" href="/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="/css/poole.css">
  <link type="text/css" rel="stylesheet" href="/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      <a href=""><h1>anwu&#39;s blog</h1></a>
      <p class="lead">
       风中的人都自以为坚毅，却都缩着脖子。 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="">Home</a> </li>
        <li><a href="/categories/"> categories </a></li><li><a href="/tags/"> tags </a></li><li><a href="/about/"> xme </a></li>
      </ul>
    </nav>

    <p class="sidebar-sticky"><a target="_Blank" href="https://beian.miit.gov.cn/">京ICP备2021000005号</a></p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>Golang Reflect</h1>
  <time datetime=2020-04-07T21:14:01&#43;0800 class="post-date">2020-04-07</time>
  <h2 id="reflect包基本基于两个基础类型">reflect包基本基于两个基础类型</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">Value</span> <span style="color:#75715e">//值
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">Type</span>  <span style="color:#75715e">//类型
</span></code></pre></div><h2 id="valuetype-的获取方法">value/type 的获取方法</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">struct</span>{
        <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span>
        <span style="color:#a6e22e">Value</span> <span style="color:#66d9ef">string</span>
    }{
        <span style="color:#a6e22e">Name</span>:<span style="color:#e6db74">&#34;n&#34;</span>,
        <span style="color:#a6e22e">Value</span>:<span style="color:#e6db74">&#34;v&#34;</span>,
    }
    <span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">TypeOf</span>(<span style="color:#a6e22e">p</span>)   
    <span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#a6e22e">p</span>)
</code></pre></div><h2 id="valuetype-可以使用kind函数获得具体类型大致类型如下">value/type 可以使用kind函数获得具体类型，大致类型如下</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#a6e22e">Bool</span>
    <span style="color:#a6e22e">Int</span>
    <span style="color:#a6e22e">Int8</span>
    <span style="color:#a6e22e">Int16</span>
    <span style="color:#a6e22e">Int32</span>
    <span style="color:#a6e22e">Int64</span>
    <span style="color:#a6e22e">Uint</span>
    <span style="color:#a6e22e">Uint8</span>
    <span style="color:#a6e22e">Uint16</span>
    <span style="color:#a6e22e">Uint32</span>
    <span style="color:#a6e22e">Uint64</span>
    <span style="color:#a6e22e">Uintptr</span>
    <span style="color:#a6e22e">Float32</span>
    <span style="color:#a6e22e">Float64</span>
    <span style="color:#a6e22e">Complex64</span>
    <span style="color:#a6e22e">Complex128</span>
    <span style="color:#a6e22e">Array</span>       <span style="color:#75715e">//数组
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Chan</span>        <span style="color:#75715e">//channel
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Func</span>        <span style="color:#75715e">//函数
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Interface</span>   <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Map</span>         <span style="color:#75715e">//map
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Ptr</span>         <span style="color:#75715e">//指针
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Slice</span>       <span style="color:#75715e">//切片
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">String</span>      <span style="color:#75715e">//字符串
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Struct</span>      <span style="color:#75715e">//结构体
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">UnsafePointer</span>
</code></pre></div><h3 id="一未知参数的解析">一、未知参数的解析</h3>
<h4 id="1如果kind为基础数据类型可以直接使用int这种方式强转处理">1.如果kind为基础数据类型可以直接使用.(int)这种方式强转处理</h4>
<h4 id="2如果kind为ptr指针-可以通过-valueelem-转换具体值">2.如果kind为ptr（指针） 可以通过 value.Elem() 转换具体值</h4>
<h4 id="3如果kind为struct">3.如果kind为struct</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">NumField</span>(); <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
        <span style="color:#a6e22e">f</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Field</span>(<span style="color:#a6e22e">i</span>)  <span style="color:#75715e">//获取结构体属性类型，可以用来获取tag等
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">vf</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Field</span>(<span style="color:#a6e22e">i</span>) <span style="color:#75715e">//获取结构体属性具体值
</span><span style="color:#75715e"></span>    }
</code></pre></div><h4 id="4如果kind为map">4.如果kind为map</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#a6e22e">iter</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">MapRange</span>()<span style="color:#75715e">//获取map迭代器
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">iter</span>.<span style="color:#a6e22e">Next</span>() {
        <span style="color:#a6e22e">k</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">iter</span>.<span style="color:#a6e22e">Key</span>()     <span style="color:#75715e">//K/V都是value对象，可以进一步解析
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">iv</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">iter</span>.<span style="color:#a6e22e">Value</span>()
        <span style="color:#75715e">//TODO k/v
</span><span style="color:#75715e"></span>    }
</code></pre></div><h4 id="5如果kind为map数组或切片">5.如果kind为map数组或切片</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">kind</span>() <span style="color:#f92672">==</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">Slice</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">kind</span>() <span style="color:#f92672">==</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">Array</span>  {
        <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">idx</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span> ;<span style="color:#a6e22e">idx</span> &lt; <span style="color:#a6e22e">iv</span>.<span style="color:#a6e22e">Len</span>() ; <span style="color:#a6e22e">idx</span> <span style="color:#f92672">++</span> {
            <span style="color:#a6e22e">currValue</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">iv</span>.<span style="color:#a6e22e">Index</span>(<span style="color:#a6e22e">idx</span>)<span style="color:#75715e">//获取切片或数组中的某一元素
</span><span style="color:#75715e"></span>            <span style="color:#75715e">//TODO currvalue
</span><span style="color:#75715e"></span>        }
    }
</code></pre></div><h3 id="二未知参数的创建">二、未知参数的创建</h3>
<h4 id="1获取一个未知变量的类型">1.获取一个未知变量的类型</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#75715e">//以下两种获取方式都可以
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//这里忽略int等基础类型，主要针对于结构体，结构体指针等
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">TypeOf</span>(<span style="color:#a6e22e">p</span>)
    <span style="color:#a6e22e">t</span><span style="color:#f92672">:=</span><span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#a6e22e">p</span>).<span style="color:#a6e22e">Type</span>()
</code></pre></div><h4 id="2创建这个变量">2.创建这个变量</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">     <span style="color:#a6e22e">sptr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">t</span>)<span style="color:#75715e">//此时得到结构体指针
</span><span style="color:#75715e"></span>     <span style="color:#a6e22e">structValue</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sptr</span>.<span style="color:#a6e22e">Elem</span>() <span style="color:#75715e">//此时获得结构体变量
</span></code></pre></div><h4 id="3创建一个结构体切片">3.创建一个结构体切片</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#a6e22e">elemType</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#a6e22e">p</span>).<span style="color:#a6e22e">Type</span>() <span style="color:#75715e">//获取切片单个元素的类型
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">sliceType</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">SliceOf</span>(<span style="color:#a6e22e">elemType</span>) <span style="color:#75715e">//获取结构体切片类型
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">sliceValue</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">MakeSlice</span>(<span style="color:#a6e22e">sliceType</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>) <span style="color:#75715e">//创建切片
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">slicePtr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">sliceValue</span>.<span style="color:#a6e22e">Type</span>()) <span style="color:#75715e">//创建切片指针
</span></code></pre></div><h4 id="4创建一个结构体map">4.创建一个结构体map</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#75715e">//获取k/v类型
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">kType</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">TypeOf</span>(<span style="color:#a6e22e">key</span>)
    <span style="color:#a6e22e">vType</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">TypeOf</span>(<span style="color:#a6e22e">value</span>)
    <span style="color:#75715e">//获取要创建的map Type
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">mType</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">MapOf</span>(<span style="color:#a6e22e">kType</span>,<span style="color:#a6e22e">vType</span>)
    <span style="color:#75715e">//创建这个map
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">mapValue</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">MakeMap</span>(<span style="color:#a6e22e">mType</span>)<span style="color:#75715e">//make
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">results</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">mapValue</span>.<span style="color:#a6e22e">Type</span>())<span style="color:#75715e">//指针
</span></code></pre></div><h3 id="二未知参数的赋值">二、未知参数的赋值</h3>
<h4 id="1解析未知结构体并赋值">1.解析未知结构体并赋值</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#75715e">//假设我们获取了一个struct的类型t
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">NumField</span>(); <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
        <span style="color:#a6e22e">vf</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Field</span>(<span style="color:#a6e22e">i</span>) <span style="color:#75715e">//获取结构体属性具体值
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">vf</span>.<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#ae81ff">1</span>)) <span style="color:#75715e">//给这个属性赋值
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//更多个性化赋值
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// vf.SetString(&#34;1&#34;) 
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// vf.SetInt(1)
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// vf.SetBool(true)
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>    }
</code></pre></div>
</div>


    </main>

    
      
    
  </body>
</html>
